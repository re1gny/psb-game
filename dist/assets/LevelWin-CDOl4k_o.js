import{j as t,m as o,r as p,a as j,A as L,b as R}from"./index-CvYwoJR4.js";import{P as S}from"./Path-CYbZrZE4.js";import{C as b,A as w}from"./characters-B4dSfI-F.js";import{a8 as k}from"./overlay-Czfck0e1.js";import{A as g}from"./levels-xABu_lhp.js";import{u as C}from"./useStep-C8oNmvPZ.js";import{n as O}from"./new-overlay-BlR4uUT7.js";import{B as A}from"./Button-Cf5Tuaq3.js";import{q as E}from"./overlay-loose-BOz6UWXF.js";import{u as N}from"./progressStore-z9eqeLM_.js";const u={0:{initialX:-40,initialY:162,initialRotate:-10,x:12,y:162,z:1,rotate:-5,origin:"top left"},1:{initialX:200,initialY:195.51,initialRotate:10,x:154.85,y:195.51,z:2,rotate:5,origin:"bottom left"}},F=c=>{const{className:i,cards:e,...x}=c;return t.jsxs(o.div,{className:`absolute top-0 left-0 w-full h-full z-30 ${i??""}`,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.4}},...x,children:[t.jsx(o.img,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute top-0 left-0 w-full h-full",src:k,alt:""}),t.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-full h-full max-w-[calc(375px*var(--size-ratio))] max-h-[calc(667px*var(--size-ratio))]",children:[t.jsxs(o.svg,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,transition:{duration:.5,ease:"linear"}},transition:{duration:.3,ease:"easeInOut"},className:"w-[calc(273px*var(--size-ratio))] h-[calc(587px*var(--size-ratio)] absolute left-[calc(55.5px*var(--size-ratio))] top-[calc(22px*var(--size-ratio))]",viewBox:"0 0 273 587",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M271.5 65L179.5 159L240.5 32L271.5 65Z",fill:"#EA5616"}),t.jsx("path",{d:"M197 78.5L159.5 166L173 70.5L197 78.5Z",fill:"#EA5616"}),t.jsx("path",{d:"M146.5 2L153.5 144.5L106.5 6.5L146.5 2Z",fill:"#EA5616"}),t.jsx("path",{d:"M5 539L87.5 457.5L36 584.5L5 539Z",fill:"#EA5616"}),t.jsx("path",{d:"M115 542.5L94.5 473L84 556.5L115 542.5Z",fill:"#EA5616"}),t.jsx("path",{d:"M1.5 469.5L71.5 453.5L1.5 495V469.5Z",fill:"#EA5616"}),t.jsx("path",{d:"M271.5 65L179.5 159L240.5 32L271.5 65Z",stroke:"black",className:"stroke-[calc(2px*var(--size-ratio))]"}),t.jsx("path",{d:"M197 78.5L159.5 166L173 70.5L197 78.5Z",stroke:"black",className:"stroke-[calc(2px*var(--size-ratio))]"}),t.jsx("path",{d:"M146.5 2L153.5 144.5L106.5 6.5L146.5 2Z",stroke:"black",className:"stroke-[calc(2px*var(--size-ratio))]"}),t.jsx("path",{d:"M5 539L87.5 457.5L36 584.5L5 539Z",stroke:"black",className:"stroke-[calc(2px*var(--size-ratio))]"}),t.jsx("path",{d:"M115 542.5L94.5 473L84 556.5L115 542.5Z",stroke:"black",className:"stroke-[calc(2px*var(--size-ratio))]"}),t.jsx("path",{d:"M1.5 469.5L71.5 453.5L1.5 495V469.5Z",stroke:"black",className:"stroke-[calc(2px*var(--size-ratio))]"})]}),e.map((r,s)=>t.jsx(o.div,{className:"absolute top-0 left-0",initial:{x:`calc(${u[s].initialX}px*var(--size-ratio))`,y:`calc(${u[s].initialY}px*var(--size-ratio))`,rotate:u[s].initialRotate},animate:{x:`calc(${u[s].x}px*var(--size-ratio))`,y:`calc(${u[s].y}px*var(--size-ratio))`,rotate:u[s].rotate},exit:{transition:{duration:.5,ease:"linear"}},transition:{duration:.3,ease:"easeInOut"},style:{transformOrigin:u[s].origin},children:t.jsx(b,{height:298.53,width:184.59,character:r})},s))]})]})},I={0:{initialX:57,initialY:122,initialRotate:0,x:57,y:122,z:1,rotate:0,exitX:-83,exitY:-98,exitRotate:-6}},P={0:{initialX:37.84,initialY:110,initialRotate:-5,x:47.84,y:100,z:1,rotate:-5,exitX:-63,exitY:-73,exitRotate:-6},1:{initialX:97.45,initialY:229.43,initialRotate:5,x:120.45,y:239.43,z:2,rotate:5,exitX:-59,exitY:-60,exitRotate:-6}},$=c=>{const{className:i,cards:e,onFinish:x,onNext:r,collectionRef:s,...m}=c,[h,d]=p.useState(!1),[v,y]=p.useState(0),n=p.useRef(null);p.useLayoutEffect(()=>{const f=j.getState().contentRef;if(n.current&&(f!=null&&f.current)){const l=j.getState().sizeRatio;y((n.current.getBoundingClientRect().left-f.current.getBoundingClientRect().left)/l)}},[n.current]);const z=()=>{r==null||r(),d(!0)},a=e.length===2?P:I;return t.jsx(o.div,{className:`absolute top-0 left-0 w-full h-full z-30 ${i??""}`,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.4}},...m,children:t.jsx(L,{onExitComplete:()=>x==null?void 0:x(),children:!h&&t.jsxs(t.Fragment,{children:[t.jsx(o.img,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute top-0 left-0 w-full h-full",src:E,alt:""}),t.jsx(o.div,{initial:{opacity:0,scale:.6,rotate:-25},animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,transition:{duration:.2,ease:"easeInOut"}},transition:{duration:.4,ease:"easeInOut"},className:"absolute top-0 left-0 w-full h-full",children:t.jsx("img",{className:"absolute top-[calc(-141px*var(--size-ratio))] left-1/2 -translate-x-1/2 w-[calc(730px*var(--size-ratio))] h-[calc(948px*var(--size-ratio))]",src:O,alt:""})}),t.jsxs("div",{ref:n,className:"absolute top-0 left-1/2 -translate-x-1/2 w-full h-full max-w-[calc(375px*var(--size-ratio))] max-h-[calc(667px*var(--size-ratio))]",children:[t.jsx(o.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0},className:"flex flex-col items-center absolute top-[calc(26px*var(--size-ratio))] left-[calc(20px*var(--size-ratio))] w-[calc(100%-(40px*var(--size-ratio)))]",children:t.jsx(o.div,{className:"relative flex items-center justify-center bg-[#FFFFFF] border-2 border-[#000000] rounded-[calc(7.41px*var(--size-ratio))] w-full h-[calc(62px*var(--size-ratio))] z-10",children:t.jsx("p",{className:"whitespace-pre-line font-inter font-semibold text-[calc(20px*var(--size-ratio))] leading-[105%] tracking-[0.01em] text-[#00029D]",children:e.length===2?"Ты получил новые карты!":"Ты получил новую карту!"})})}),e.map((f,l)=>t.jsx(o.div,{className:"absolute top-0 left-0 rounded-[calc(8.79px*var(--size-ratio))]",initial:{opacity:0,x:`calc(${a[l].initialX}px*var(--size-ratio))`,y:`calc(${a[l].initialY}px*var(--size-ratio))`,rotate:a[l].initialRotate,scale:0,boxShadow:"none"},animate:{opacity:1,x:`calc(${a[l].x}px*var(--size-ratio))`,y:`calc(${a[l].y}px*var(--size-ratio))`,rotate:a[l].rotate,scale:1,boxShadow:"calc(0px*var(--size-ratio)) calc(0px*var(--size-ratio)) calc(22px*var(--size-ratio)) calc(0px*var(--size-ratio)) #FFFFFF"},exit:{opacity:0,x:`calc(${a[l].exitX-v}px*var(--size-ratio))`,y:`calc(${a[l].exitY}px*var(--size-ratio))`,rotate:a[l].exitRotate,scale:.05,boxShadow:"none",transition:{duration:.8,ease:"easeInOut",opacity:{delay:.5,duration:.3},rotate:{delay:.3,duration:.5}}},children:t.jsx(b,{height:e.length===2?337.66:422,width:e.length===2?208.78:260.93,character:f})},l))]}),t.jsx(o.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0},className:"flex flex-col items-center absolute bottom-[calc(30px*var(--size-ratio))] left-[calc(20px*var(--size-ratio))] w-[calc(100%-(40px*var(--size-ratio)))]",children:t.jsx(A,{className:"absolute",onClick:z,children:"Забрать"})})]})})})};function q({level:c}){const[i,e]=C(`level-${c.id}-win`,0),x=R(),[r,s]=p.useState(!1),m=p.useRef(null),h=N(a=>a.shouldShowPathRules),d=N(a=>a.applyPathRules),v=w.filter(a=>c.correctCharacters.includes(a.id)),y=w.filter(a=>c.winNewCharacters.includes(a.id)),n=c.id===g[g.length-1].id,z=()=>{e(),s(!0)};return p.useEffect(()=>{i===0&&setTimeout(()=>e(),300),i===1&&setTimeout(()=>e(),1600),!n&&i===2&&setTimeout(()=>e(),300),n&&i===2&&setTimeout(()=>x({to:"/final"}),800)},[i]),p.useEffect(()=>{r&&setTimeout(()=>s(!1),200)},[r]),t.jsxs(t.Fragment,{children:[t.jsx(S,{withRules:h&&i===5,blur:i===1||i===3,pulse:r,collectionRef:m,onPassRules:d}),t.jsx(L,{children:i===1&&t.jsx(F,{cards:v})}),t.jsx(L,{children:(i===3||i===4)&&!n&&t.jsx($,{cards:y,onFinish:z,onNext:e,collectionRef:m})})]})}export{q as L};
